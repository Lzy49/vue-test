<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>组合式 API</title>
  </head>
  <body>
    <div id="root">
      <div>
        <test-component
          :atter1="atter1"
          :atter2="atter2"
          v-bind="info"
          @fun1="fun1"
          @fun2="fun2"
        ></test-component>
      </div>
    </div>
    <script src="https://unpkg.com/vue@next"></script>
    <script>
      const { h, onMounted, inject, provide, ref, readonly } = Vue;
      const testComponent = {
        props: { name: String, atter1: String },
        emits: ['fun1'],
        setup(props, context) {
          /**
           * setup： 一个组件选项，在创建组件之前执行，一旦 props 被解析，并作为组合式 API 的入口点
           * 接收 2个参数 props 和 context
           *  props 包含从父组件传递来的 被 props 接收的参数 和 被 emits 接收的方法
           *  context 中包含了 3个模块
           *   - refs 该作用域中的 refs 相当于 this.$refs
           *   - attrs 没有被 props 和 emits 接收的 参数 和方法
           *   - emit 调用 父组件传递方法的函数
           */
          console.log(props, context);
          context.emit('fun2');
          context.emit('fun1');

          /**
           * 生命周期钩子
           * 在 setup 中使用生命周期可以使用生命周期钩子 。created 中所执行的操作都可以 在 setup 中执行。其他生命周期的可以使用 onXX 钩子
           */
          onMounted(() => {
            console.log('我会在 mounted 时执行');
          });
          /**
           * Provide / Inject
           * - Provide 抛出值可以使用 provide 函数传入两个值 key value
           * - inject 可以接收 通过 provide 传递来的值 传如参数key
           */
          const value = inject('value');
          console.log(value.value); // 10
          value.value++; // warning
          const setValue = inject('setValue');
          setValue(200);
          console.log(value.value); // 200
          return () => h('div', {}, '你好');
        }
      };
      const app = Vue.createApp({
        setup() {
          const v = ref(10);
          provide('value', readonly(v));
          provide('setValue', (value) => (v.value = value));
        },
        data() {
          return {
            value: 1,
            atter1: 'atter1',
            atter2: 'atter2',
            info: {
              name: '张飞',
              age: 18
            }
          };
        },
        components: { testComponent },
        methods: {
          fun1() {
            console.log('I am fun1');
          },
          fun2() {
            console.log('I am fun2');
          }
        }
      });
      app.mount('#root');
    </script>
  </body>
</html>
